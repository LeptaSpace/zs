<class name = "zs_core" script = "fsm_c">

<state name = "parsing text" inherit = "defaults">
    <event name = "number">
        <action name = "push number to output" />
        <action name = "get next token" />
    </event>
    <event name = "string">
        <action name = "push string to output" />
        <action name = "get next token" />
    </event>
    <event name = "function" next = "after function">
        <action name = "resolve function name" />
        <action name = "get next token" />
    </event>
    <event name = "close">
        <action name = "close function scope" />
        <action name = "get next token" />
    </event>
<!--    <event name = "compose" next = "expecting open">
        <action name = "name must be unknown" />
        <action name = "open composition" />
        <action name = "get next token" />
    </event>-->
</state>

<state name = "after function" inherit = "defaults">
    <event name = "open" next = "parsing text">
        <action name = "open function scope" />
        <action name = "get next token" />
    </event>
    <event name = "number" next = "parsing text">
        <action name = "call simple function" />
        <action name = "push number to output" />
        <action name = "get next token" />
    </event>
    <event name = "string" next = "parsing text">
        <action name = "call simple function" />
        <action name = "push string to output" />
        <action name = "get next token" />
    </event>
    <event name = "function" next = "after function">
        <action name = "call simple function" />
        <action name = "resolve function name" />
        <action name = "get next token" />
    </event>
    <event name = "close">
        <action name = "call simple function" />
        <action name = "close function scope" />
        <action name = "get next token" />
    </event>
    <event name = "eol" next = "parsing text">
        <action name = "call simple function" />
        <action name = "check if completed" />
    </event>
</state>

<!--<state name = "expecting open" inherit = "defaults">
    <event name = "open" next = "composing">
        <action name = "get next token" />
    </event>
</state>-->

<!--<state name = "composing" inherit = "defaults">
    <event name = "number">
        <action name = "compose number value" />
        <action name = "get next token" />
    </event>
    <event name = "string">
        <action name = "compose string value" />
        <action name = "get next token" />
    </event>
    <event name = "function">
        <action name = "compose function" />
        <action name = "get next token" />
    </event>
    <event name = "close" next = "parsing text">
        <action name = "close composition" />
        <action name = "get next token" />
    </event>
</state>-->

<state name = "defaults">
    <event name = "number" next = "parsing text">
        <action name = "signal syntax error" />
    </event>
    <event name = "string" next = "parsing text">
        <action name = "signal syntax error" />
    </event>
    <event name = "function" next = "parsing text">
        <action name = "signal syntax error" />
    </event>
    <event name = "compose" next = "parsing text">
        <action name = "signal syntax error" />
    </event>
    <event name = "open" next = "parsing text">
        <action name = "signal syntax error" />
    </event>
    <event name = "close" next = "parsing text">
        <action name = "signal syntax error" />
    </event>
    <event name = "invalid" next = "parsing text">
        <action name = "signal syntax error" />
    </event>
    <event name = "eol" next = "parsing text">
        <action name = "check if completed" />
    </event>
    <event name = "completed" next = "parsing text">
        <action name = "signal completed" />
    </event>
</state>

</class>
